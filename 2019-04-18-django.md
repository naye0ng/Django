# Django - following posts

*2019.04.17*

following posts : íŒ”ë¡œì‰í•˜ê³  ìˆëŠ” ì‚¬ëŒë“¤ì˜ ê²Œì‹œê¸€ê³¼ ìì‹ ì˜ ê²Œì‹œê¸€ë§Œ ë³´ì—¬ì£¼ê¸°

## 1. Django Queryset
[Django Queryset](https://docs.djangoproject.com/ko/2.1/ref/models/querysets/)

### 1-1. filer() ğŸ¤Ÿ

getì€ í•œ ê°€ì§€ë¥¼ ê°€ì ¸ì˜¨ë‹¤ë©´, filterëŠ” ì¡°ê±´ì— ë§ëŠ” ì—¬ëŸ¬ ê°œì˜ ê²°ê³¼ê°’ì„ ê°€ì ¸ì˜¨ë‹¤.

> Post.objects.**filter**(content**__{ì˜µì…˜}**={ëŒ€ìƒ})
> {ì˜µì…˜} exact, iexact, contains, icontanins, in, startswith, endwith, gt(e), lt(e)



[ë°©ë²• 1] ì§ì ‘ queryset í•©ì¹˜ê¸°

```python
#accounts/views.py
def list(request) :
    # ë‚´ê°€ íŒ”ë¡œìš°í•œ ì‚¬ëŒë“¤ì˜ postë¥¼ ë³´ì—¬ì¤€ë‹¤.
    follow_posts = Post.objects.filter(user_id__in= request.user.followings.all())
    # ë‚´ê°€ ì“´ post ëª©ë¡ì„ ë³´ì—¬ì¤€ë‹¤.
    my_posts = request.user.post_set.all()
    # queryset í•©ì¹˜ê¸°
    posts = follow_posts | my_posts

    commentForm = CommentModelForm()
    return render(request,'posts/list.html', {'posts' : posts, 'commentForm':commentForm})
```



[ë°©ë²• 2] **Që¥¼ ì‚¬ìš©**í•˜ì—¬ ë³µí•© queryset ë§Œë“¤ê¸°ğŸ¤Ÿ

```python
from django.db.models import Q

def list(request) :
	posts = Post.objects.filter(Q(user_id__in= request.user.followings.all()) | Q(user=request.user))
```

filter(Post ëª¨ë¸ì—ì„œ Q(í˜„ì¬ request.userê°€ followingí•˜ê³  ìˆëŠ” user_id ê°’ê³¼ ê°™ì€ post ê°ì²´ë¥¼ ì¶œë ¥í•˜ë¼ ) + Q(request.userì™€ ê°™ì€ userê°€ ì“´ postë¥¼ ì¶œë ¥í•´ë¼))



### 1-2. Query ì¶œë ¥

ì‹¤ì œ Djangoì˜ Querysetì´ DBì— ì–´ë–¤ ì¿¼ë¦¬ë¥¼ ë‚ ë¦¬ëŠ”ì§€ ê¶ê¸ˆí•˜ë‹¤ë©´ **.query**ë¥¼ ì´ìš©í•˜ì—¬ ì¶œë ¥í•  ìˆ˜ ìˆë‹¤.

```python
posts = posts = Post.objects.filter(user_id__in= request.user.followings.all()) | request.user.post_set.all()
print(posts.query)

# ê²°ê³¼
SELECT "posts_post"."id", "posts_post"."content", "posts_post"."image", "posts_post"."user_id" FROM "posts_post" WHERE ("posts_post"."user_id" IN (SELECT U0."id" FROM "accounts_user" U0 INNER JOIN "accounts_user_followers" U1 ON (U0."id" = U1."from_user_id") WHERE U1."to_user_id" = 2) OR "posts_post"."user_id" = 2)
```



## 2. profile image

### 2-1. models ë³€ê²½

models.pyì— image í•„ë“œ ì¶”ê°€

```python
# accounts/models.py
class Profile(models.Model) :
    user = models.OneToOneField(settings.AUTH_USER_MODEL,on_delete=models.CASCADE)
    description = models.TextField(blank=True)
    nickname = models.CharField(max_length=50, blank=True)
    userimage = models.ImageField(blank=True)
```



### 2-2. ë¯¸ë””ì–´ íŒŒì¼ ì—…ë¡œë“œ ë‹¨ê³„


1. [project]settings.pyì— media ê²½ë¡œ ì„¤ì •
2. [project]urls.pyì— staticê²½ë¡œ ì„¤ì •
3. formíƒœê·¸ì— enctype='multipart/form-data' ì¶”ê°€
4. ModelFormì„ ì‚¬ìš©í•˜ê³  ìˆë‹¤ë©´, files = request.FILES ë§¤ê²Œë³€ìˆ˜ ì¶”ê°€

[Django ì´ë¯¸ì§€ì—…ë¡œë“œ ì •ë¦¬](./2019-04-11-django.md)



<hr>

### [ì¶”ê°€] Django code clone

```shell
mkdir QUEST
cd QUEST
```

```shell
#!/bin/sh
git clone https://github.com/pyenv/pyenv.git ~/.pyenv
echo 'export PYENV_ROOT="$HOME/.pyenv"' >> ~/.bashrc
echo 'export PATH="$PYENV_ROOT/bin:$PATH"' >> ~/.bashrc
echo -e 'if command -v pyenv 1>/dev/null 2>&1; then\n  eval "$(pyenv init -)"\nfi' >> ~/.bashrc
source ~/.bashrc
pyenv install 3.6.8
pyenv global 3.6.8
git clone https://github.com/pyenv/pyenv-virtualenv.git $(pyenv root)/plugins/pyenv-virtualenv
echo 'eval "$(pyenv virtualenv-init -)"' >> ~/.bashrc
exec "$SHELL"
pyenv virtualenv 3.6.8 django-venv
pyenv local django-venv
pip install --upgrade pip
pip install django==2.1.8
echo '===========setting==========='
pip list
python -V
echo '===========setting==========='
# git clone {í”„ë¡œì íŠ¸ ì½”ë“œ}
```
